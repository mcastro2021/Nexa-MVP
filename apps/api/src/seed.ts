import { PrismaClient } from '@prisma/client';
import bcrypt from 'bcryptjs';

const prisma = new PrismaClient();

const faqsPre = [
  {
    etapa: 'pre',
    categoria: 'GENERAL',
    pregunta: '¬øCu√°ntos a√±os de experiencia tienen en steel/wood frame?',
    respuesta: 'Tenemos m√°s de 15 a√±os de experiencia en construcci√≥n con steel frame y wood frame, con m√°s de 200 proyectos entregados exitosamente en toda la regi√≥n.',
    orden: 1
  },
  {
    etapa: 'pre',
    categoria: 'GENERAL',
    pregunta: '¬øTienen cat√°logo de proyectos anteriores/casas modelo?',
    respuesta: 'S√≠, contamos con un amplio cat√°logo de proyectos realizados que incluye casas de 80m¬≤ hasta 300m¬≤. Puedes verlos en nuestra galer√≠a o solicitar una visita a alguna obra en curso.',
    orden: 2
  },
  {
    etapa: 'pre',
    categoria: 'MATERIALES',
    pregunta: '¬øQu√© materiales usan y qu√© certificaciones tienen?',
    respuesta: 'Utilizamos estructuras galvanizadas certificadas ASTM A653 y madera tratada IRAM 9662. Nuestras aislaciones t√©rmicas cumplen con normas IRAM 11605 y contamos con certificaci√≥n ISO 9001:2015.',
    orden: 3
  },
  {
    etapa: 'pre',
    categoria: 'GARANTIA',
    pregunta: '¬øQu√© garant√≠a ofrecen en la construcci√≥n?',
    respuesta: 'Ofrecemos garant√≠a de 10 a√±os en la estructura principal, 5 a√±os en instalaciones y 2 a√±os en terminaciones. Todos nuestros materiales incluyen garant√≠a de f√°brica.',
    orden: 4
  },
  {
    etapa: 'pre',
    categoria: 'PRECIOS',
    pregunta: '¬øEl precio incluye todo? ¬øHay costos extra?',
    respuesta: 'Nuestro precio incluye: estructura, aislaci√≥n, instalaciones b√°sicas, terminaciones est√°ndar y mano de obra. Los costos extra pueden ser: personalizaciones especiales, ampliaciones de dise√±o o materiales premium.',
    orden: 5
  },
  {
    etapa: 'pre',
    categoria: 'TIEMPOS',
    pregunta: '¬øCu√°nto tiempo tardan en construir una casa de 120m¬≤?',
    respuesta: 'Una casa de 120m¬≤ en steel frame se construye en aproximadamente 3-4 meses desde la aprobaci√≥n de planos hasta la entrega llave en mano. Los tiempos pueden variar seg√∫n la complejidad del dise√±o.',
    orden: 6
  },
  {
    etapa: 'pre',
    categoria: 'PROCESO',
    pregunta: '¬øC√≥mo es el proceso de dise√±o y construcci√≥n?',
    respuesta: 'El proceso incluye: 1) Dise√±o personalizado seg√∫n tus necesidades, 2) Aprobaci√≥n de planos municipales, 3) Construcci√≥n por etapas con reportes semanales, 4) Entrega llave en mano con certificado de habitabilidad.',
    orden: 7
  },
  {
    etapa: 'pre',
    categoria: 'SERVICIOS',
    pregunta: '¬øOfrecen muebles a medida y financiaci√≥n?',
    respuesta: 'S√≠, ofrecemos muebles a medida para cocina, dormitorios y ba√±os. Tambi√©n tenemos convenios con bancos para financiaci√≥n a tasas preferenciales, con plazos de hasta 10 a√±os.',
    orden: 8
  }
];

const faqsPost = [
  {
    etapa: 'post',
    categoria: 'OBRAS',
    pregunta: '¬øCu√°l es el cronograma de la obra?',
    respuesta: 'El cronograma detallado est√° disponible en tu portal personal. Incluye fechas de cada hito: cimientos, estructura, aislaci√≥n, instalaciones, terminaciones y entrega final.',
    orden: 1
  },
  {
    etapa: 'post',
    categoria: 'OBRAS',
    pregunta: '¬øC√≥mo se manejan los imprevistos y demoras?',
    respuesta: 'Ante cualquier imprevisto, nuestro equipo te notifica inmediatamente por WhatsApp y actualiza el cronograma. Las demoras se compensan ajustando la programaci√≥n para mantener la fecha de entrega comprometida.',
    orden: 2
  },
  {
    etapa: 'post',
    categoria: 'CONTACTO',
    pregunta: '¬øQui√©n es mi encargado de obra y c√≥mo lo contacto?',
    respuesta: 'Tu encargado de obra es asignado al inicio del proyecto y te enviamos sus datos de contacto. Tambi√©n puedes comunicarte a trav√©s del portal o crear un ticket de soporte.',
    orden: 3
  },
  {
    etapa: 'post',
    categoria: 'MATERIALES',
    pregunta: '¬øPuedo elegir terminaciones diferentes a las del contrato?',
    respuesta: 'S√≠, puedes personalizar terminaciones hasta 2 semanas antes de cada etapa. Los cambios se cotizan por separado y pueden afectar los plazos de entrega.',
    orden: 4
  },
  {
    etapa: 'post',
    categoria: 'PAGOS',
    pregunta: '¬øCu√°ndo es mi pr√≥ximo pago y por qu√© monto?',
    respuesta: 'Tu pr√≥ximo pago est√° programado seg√∫n el cronograma financiero. Puedes ver el detalle completo en tu portal: Mi Proyecto ‚Üí Pagos, incluyendo monto, concepto y fecha de vencimiento.',
    orden: 5
  },
  {
    etapa: 'post',
    categoria: 'MUEBLES',
    pregunta: '¬øCu√°ndo debo decidir sobre muebles a medida?',
    respuesta: 'Para muebles a medida, debes confirmar el dise√±o 1 mes antes de la etapa de terminaciones. Nuestro equipo de dise√±o te contactar√° para coordinar la visita y presentar opciones.',
    orden: 6
  },
  {
    etapa: 'post',
    categoria: 'FINANCIACION',
    pregunta: '¬øC√≥mo va mi solicitud de pr√©stamo bancario?',
    respuesta: 'El estado de tu solicitud de pr√©stamo se actualiza en tiempo real en tu portal. Nuestro asesor financiero te contactar√° cuando haya novedades o se requiera documentaci√≥n adicional.',
    orden: 7
  }
];

async function main() {
  console.log('üå± Iniciando seed de la base de datos...');

  // Crear usuarios demo con diferentes roles
  const passwordHash = await bcrypt.hash('password123', 10);

  const usuarios = [
    {
      email: 'cliente@demo.com',
      hash: passwordHash,
      nombre: 'Juan P√©rez',
      telefono: '+54 9 11 1234-5678',
      role: 'CLIENTE' as const,
      cliente: {
        create: {
          direccion: 'Av. Libertador 1234, CABA',
          dni: '12345678'
        }
      }
    },
    {
      email: 'admin@demo.com',
      hash: passwordHash,
      nombre: 'Mar√≠a Gonz√°lez',
      telefono: '+54 9 11 2345-6789',
      role: 'ADMIN' as const,
      empleado: {
        create: {
          area: 'Administraci√≥n',
          puesto: 'Gerente Administrativa',
          antiguedad: 24,
          salario: 150000
        }
      }
    },
    {
      email: 'logistica@demo.com',
      hash: passwordHash,
      nombre: 'Carlos Rodr√≠guez',
      telefono: '+54 9 11 3456-7890',
      role: 'LOGISTICA' as const,
      empleado: {
        create: {
          area: 'Log√≠stica',
          puesto: 'Jefe de Log√≠stica',
          antiguedad: 18,
          salario: 120000
        }
      }
    },
    {
      email: 'ejecutivo@demo.com',
      hash: passwordHash,
      nombre: 'Ana Mart√≠nez',
      telefono: '+54 9 11 4567-8901',
      role: 'EJECUTIVO' as const,
      empleado: {
        create: {
          area: 'Direcci√≥n',
          puesto: 'Directora Ejecutiva',
          antiguedad: 36,
          salario: 200000
        }
      }
    }
  ];

  console.log('üë• Creando usuarios demo...');
  for (const usuarioData of usuarios) {
    const { cliente, empleado, ...usuario } = usuarioData;
    await prisma.usuario.create({
      data: usuario,
      include: { cliente: true, empleado: true }
    });
  }

  // Crear proveedores demo
  console.log('üè≠ Creando proveedores demo...');
  const proveedores = [
    {
      nombre: 'Aceros del Sur S.A.',
      email: 'ventas@acerosdelsur.com',
      telefono: '+54 11 4567-8901',
      direccion: 'Ruta 2 Km 45, La Plata',
      cuit: '30-12345678-9'
    },
    {
      nombre: 'Maderas Premium Ltda.',
      email: 'info@maderaspremium.com',
      telefono: '+54 11 5678-9012',
      direccion: 'Av. Industrial 789, San Mart√≠n',
      cuit: '30-23456789-0'
    },
    {
      nombre: 'Aislaciones T√©rmicas S.R.L.',
      email: 'contacto@aislaciones.com',
      telefono: '+54 11 6789-0123',
      direccion: 'Zona Industrial Norte 456',
      cuit: '30-34567890-1'
    }
  ];

  for (const proveedor of proveedores) {
    await prisma.proveedor.create({ data: proveedor });
  }

  // Crear items de stock demo
  console.log('üì¶ Creando items de stock demo...');
  const stockItems = [
    {
      sku: 'SF-001',
      nombre: 'Perfil U 100x50x2mm',
      descripcion: 'Perfil estructural galvanizado U 100x50x2mm',
      unidad: 'm',
      stock: 500,
      minimo: 100,
      costoStd: 45.50,
      leadTimeDias: 7,
      categoria: 'Estructura'
    },
    {
      sku: 'SF-002',
      nombre: 'Perfil C 100x50x2mm',
      descripcion: 'Perfil estructural galvanizado C 100x50x2mm',
      unidad: 'm',
      stock: 450,
      minimo: 80,
      costoStd: 42.30,
      leadTimeDias: 7,
      categoria: 'Estructura'
    },
    {
      sku: 'WF-001',
      nombre: 'Viga 2x6 pulgadas',
      descripcion: 'Viga de madera tratada 2x6 pulgadas',
      unidad: 'm',
      stock: 200,
      minimo: 50,
      costoStd: 28.75,
      leadTimeDias: 5,
      categoria: 'Estructura'
    },
    {
      sku: 'AIS-001',
      nombre: 'Lana de vidrio 100mm',
      descripcion: 'Aislaci√≥n t√©rmica lana de vidrio 100mm',
      unidad: 'm¬≤',
      stock: 150,
      minimo: 30,
      costoStd: 15.20,
      leadTimeDias: 3,
      categoria: 'Aislaci√≥n'
    },
    {
      sku: 'PLY-001',
      nombre: 'Placa OSB 12mm',
      descripcion: 'Placa OSB estructural 12mm',
      unidad: 'm¬≤',
      stock: 80,
      minimo: 20,
      costoStd: 22.40,
      leadTimeDias: 4,
      categoria: 'Revestimiento'
    }
  ];

  for (const item of stockItems) {
    await prisma.stockItem.create({ data: item });
  }

  // Crear proyecto demo para el cliente
  console.log('üèóÔ∏è Creando proyecto demo...');
  const cliente = await prisma.usuario.findUnique({
    where: { email: 'cliente@demo.com' },
    include: { cliente: true }
  });

  if (cliente?.cliente) {
    const proyecto = await prisma.proyecto.create({
      data: {
        clienteId: cliente.cliente.id,
        nombre: 'Casa Familiar Steel Frame',
        tipo: 'STEEL_FRAME',
        m2: 120,
        direccion: 'Calle del Bosque 567, Nordelta',
        fechaInicio: new Date('2024-01-15'),
        fechaEntrega: new Date('2024-05-15'),
        estado: 'EN_OBRA',
        presupuesto: 45000000
      }
    });

    // Crear hitos del proyecto
    const hitos = [
      {
        proyectoId: proyecto.id,
        nombre: 'Cimientos y Base',
        descripcion: 'Excavaci√≥n, hormig√≥n y base de la estructura',
        estado: 'COMPLETADO',
        fechaPlan: new Date('2024-01-20'),
        fechaReal: new Date('2024-01-18'),
        porcentaje: 100
      },
      {
        proyectoId: proyecto.id,
        nombre: 'Estructura Principal',
        descripcion: 'Montaje de perfiles galvanizados',
        estado: 'EN_PROGRESO',
        fechaPlan: new Date('2024-02-15'),
        porcentaje: 75
      },
      {
        proyectoId: proyecto.id,
        nombre: 'Aislaci√≥n y Revestimiento',
        descripcion: 'Instalaci√≥n de aislaci√≥n t√©rmica y placas',
        estado: 'PENDIENTE',
        fechaPlan: new Date('2024-03-20'),
        porcentaje: 0
      },
      {
        proyectoId: proyecto.id,
        nombre: 'Instalaciones',
        descripcion: 'Electricidad, agua y gas',
        estado: 'PENDIENTE',
        fechaPlan: new Date('2024-04-10'),
        porcentaje: 0
      },
      {
        proyectoId: proyecto.id,
        nombre: 'Terminaciones',
        descripcion: 'Pintura, pisos y detalles finales',
        estado: 'PENDIENTE',
        fechaPlan: new Date('2024-05-05'),
        porcentaje: 0
      }
    ];

    for (const hito of hitos) {
      await prisma.hito.create({ data: hito });
    }

    // Crear pagos del proyecto
    const pagos = [
      {
        clienteId: cliente.cliente.id,
        proyectoId: proyecto.id,
        monto: 9000000,
        concepto: 'Adelanto inicial (20%)',
        tipo: 'ADELANTO',
        estado: 'PAGADO',
        fecha: new Date('2024-01-10')
      },
      {
        clienteId: cliente.cliente.id,
        proyectoId: proyecto.id,
        monto: 13500000,
        concepto: 'Segunda cuota (30%)',
        tipo: 'CUOTA',
        estado: 'PAGADO',
        fecha: new Date('2024-02-01')
      },
      {
        clienteId: cliente.cliente.id,
        proyectoId: proyecto.id,
        monto: 13500000,
        concepto: 'Tercera cuota (30%)',
        tipo: 'CUOTA',
        estado: 'PENDIENTE',
        vencimiento: new Date('2024-03-15')
      },
      {
        clienteId: cliente.cliente.id,
        proyectoId: proyecto.id,
        monto: 9000000,
        concepto: 'Cuota final (20%)',
        tipo: 'FINAL',
        estado: 'PENDIENTE',
        vencimiento: new Date('2024-05-01')
      }
    ];

    for (const pago of pagos) {
      await prisma.pago.create({ data: pago });
    }
  }

  // Crear FAQs
  console.log('‚ùì Creando FAQs...');
  await prisma.fAQ.createMany({ data: [...faqsPre, ...faqsPost] });

  // Crear eventos de calendario demo
  console.log('üìÖ Creando eventos de calendario demo...');
  const admin = await prisma.usuario.findUnique({
    where: { email: 'admin@demo.com' }
  });

  if (admin) {
    const eventos = [
      {
        usuarioId: admin.id,
        titulo: 'Auditor√≠a de Stock',
        descripcion: 'Revisi√≥n mensual de inventario y alertas',
        fechaInicio: new Date('2024-01-25T09:00:00'),
        fechaFin: new Date('2024-01-25T12:00:00'),
        tipo: 'AUDITORIA',
        color: '#3B82F6'
      },
      {
        usuarioId: admin.id,
        titulo: 'Reuni√≥n con Proveedores',
        descripcion: 'Negociaci√≥n de precios y plazos',
        fechaInicio: new Date('2024-01-26T14:00:00'),
        fechaFin: new Date('2024-01-26T16:00:00'),
        tipo: 'REUNION',
        color: '#10B981'
      }
    ];

    for (const evento of eventos) {
      await prisma.eventoCalendario.create({ data: evento });
    }
  }

  console.log('‚úÖ Seed completado exitosamente!');
  console.log('\nüîë Credenciales de acceso:');
  console.log('Cliente: cliente@demo.com / password123');
  console.log('Admin: admin@demo.com / password123');
  console.log('Log√≠stica: logistica@demo.com / password123');
  console.log('Ejecutivo: ejecutivo@demo.com / password123');
}

main()
  .catch((e) => {
    console.error('‚ùå Error durante el seed:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
